<Page xmlns="http://www.nativescript.org/tns.xsd" navigatedTo="navigatedTo">
  <Page.optionsMenu>
    <MenuItem icon="ic_edit" tap="{{ editTask }}" android.position="actionBar" />
    <MenuItem text="{{ strings.delete }}" tap="{{ deleteTask }}" android.position="popup" />
  </Page.optionsMenu>
  <GridLayout rows="*, auto">
    <ScrollView>
      <GridLayout rows="auto, auto, auto, auto, *, auto, auto">
        <GridLayout width="600">
          <Image stretch="aspectFill" src="{{ pictureUrl }}" visibility="{{ task.Photo ? 'visible' : 'collapsed' }}" cssClass="headerImage" />
        </GridLayout>
        
        <Label row="1" cssClass="header">
          <Label.formattedText>
            <FormattedString>
              <FormattedString.spans>
                <Span text="{{ project.Name }}" fontAttributes="Bold, Italic" />
              </FormattedString.spans>
            </FormattedString>
          </Label.formattedText>
        </Label>

        <Label row="2" text="{{ task.Name }}" cssClass="subHeader" textWrap="true"/>

        <GridLayout row="3" rows="auto, auto, auto" columns="*,*">
          <Border borderWidth="1" borderColor="#EFE9DC" cssClass="detailsBorder" visibility="{{ task.DueDate || task.ReminderDate ? 'visible' : 'collapsed' }}">
            <StackLayout cssClass="detailsContainer" orientation="horizontal" visibility="{{ task.DueDate ? 'visible' : 'collapsed' }}">
              <Image src="res://ic_duedate" cssClass="detailsIcon" stretch="none" />
              <Label text="{{ task.DueDate | formatDueDate }}" col="1" />
            </StackLayout>
          </Border>

          <Border col="1" borderWidth="1" borderColor="#EFE9DC" cssClass="detailsBorder" visibility="{{ task.DueDate || task.ReminderDate ? 'visible' : 'collapsed' }}">
            <StackLayout cssClass="detailsContainer" orientation="horizontal" visibility="{{ task.ReminderDate ? 'visible' : 'collapsed' }}">
              <Image src="res://ic_reminder" cssClass="detailsIcon" stretch="none" />
              <Label text="{{ task | formatReminder }}" col="1" />
            </StackLayout>
          </Border>

          <Border row="1" borderWidth="1" borderColor="#EFE9DC" cssClass="detailsBorder" visibility="{{ task.Phone || task.Email ? 'visible' : 'collapsed' }}">
            <StackLayout cssClass="detailsContainer" orientation="horizontal" visibility="{{ task.Phone ? 'visible' : 'collapsed' }}" >
              <Image src="res://ic_phone" cssClass="detailsIcon" stretch="none" />
              <Label text="{{ task.Phone }}" col="1" />
            </StackLayout>
          </Border>

          <Border row="1" col="1" borderWidth="1" borderColor="#EFE9DC" cssClass="detailsBorder" visibility="{{ task.Phone || task.Email ? 'visible' : 'collapsed' }}">
            <StackLayout cssClass="detailsContainer" orientation="horizontal" visibility="{{ task.Email ? 'visible' : 'collapsed' }}">
              <Image src="res://ic_email" cssClass="detailsIcon" stretch="none" />
              <Label text="{{ task.Email }}" col="1" />
            </StackLayout>
          </Border>

          <Border row="2" colSpan="2" borderWidth="1" borderColor="#EFE9DC" cssClass="detailsBorder" visibility="{{ task.Url ? 'visible' : 'collapsed' }}">
            <StackLayout cssClass="detailsContainer" orientation="horizontal" >
              <Image src="res://ic_url" cssClass="detailsIcon" stretch="none" />
              <Label text="{{ task.Url }}" col="1" />
            </StackLayout>
          </Border>
        </GridLayout>

        <Label row="4" text="{{ task.Notes }}" cssClass="notesLabel" textWrap="true" visibility="{{ task.Notes ? 'visible' : 'collapsed' }}"/>
      </GridLayout>
    </ScrollView>

    <AbsoluteLayout cssClass="fabContainer" >
      <Image src="{{ task | getStatusFab }}" tap="{{ completeTask }}" cssClass="fab" />
    </AbsoluteLayout>

    <ActivityIndicator rowSpan="2" cssClass="activityIndicator" busy="{{ isLoading }}"/>
  </GridLayout>
</Page>